################################################################################
#  Licensed to the Apache Software Foundation (ASF) under one
#  or more contributor license agreements.  See the NOTICE file
#  distributed with this work for additional information
#  regarding copyright ownership.  The ASF licenses this file
#  to you under the Apache License, Version 2.0 (the
#  "License"); you may not use this file except in compliance
#  with the License.  You may obtain a copy of the License at
#
#      http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
# limitations under the License.
################################################################################

common:
  taskmanager.memory.preallocate: false
  parallelism.default: 1
  io.tmp.dirs: /opt/tmp/flink
  taskmanager.tmp.dirs: /opt/tmp/flink
  state.backend: rocksdb
  state.checkpoints.dir: ${hdfs.prefix}/${dc}/${clusterName}/1.9/flink/fs_checkpoint_dir
  state.backend.rocksdb.localdir: /opt/tmp/flink-dev/flink-rocksdb-local
  taskmanager.network.memory.fraction: 0.3
  taskmanager.network.memory.max: 2147483648

  high-availability: zookeeper
  high-availability.storageDir: ${hdfs.prefix}/${clusterName}/1.9/ha/
  high-availability.zookeeper.path.root: /${dc}/${clusterName}/flink

  yarn.application-attempts: 5
  yarn.application-attempt-failures-validity-interval: 3600000

  job.work.dir: ${hdfs.prefix}/${clusterName}/1.9/

# fs.hdfs.hdfssite: /opt/tiger/yarn_deploy/hadoop/conf/hdfs-site.xml

  metrics.reporters: opentsdb_reporter
  metrics.reporter.opentsdb_reporter.class: org.apache.flink.metrics.opentsdb.OpentsdbReporter

  prune.buffer.threshold: 262144

  jobmanager.archive.fs.dir: ${hdfs.prefix}/${clusterName}/1.9/completed-jobs
  historyserver.archive.fs.dir: ${hdfs.prefix}/${clusterName}/1.9/completed-jobs
  historyserver.web.tmpdir: /opt/tmp/flink/historyserver/tmpdir

  akka.ask.timeout: 60 s

  containerized.jobmanager.heap-cutoff-ratio: 0.1

  flink.lib.path: lib_new_conf


  restart-strategy: failure-rate
  restart-strategy.failure-rate.max-failures-per-interval: 50
  restart-strategy.failure-rate.failure-rate-interval: 30 min
  restart-strategy.failure-rate.delay: 20 s

# restart-strategy: fixed-delay
# restart-strategy.fixed-delay.attempts: 100
# restart-strategy.fixed-delay.delay: 20 s
# The failover strategy, i.e., how the job computation recovers from task failures.
# Only restart tasks that may have been affected by the task failure, which typically includes
# downstream tasks and potentially upstream tasks if their produced data is no longer available for consumption.

  # TODO(zoudan):add region restart monitor
  jobmanager.execution.failover-strategy: region

#==============================================================================
# Rest & web frontend
#==============================================================================

  dc: cn
  check.job.unique: true

  job.unique.zookeeper.client.session-timeout: 5000
  job.unique.zookeeper.client.connection-timeout: 10000

  taskmanager.network.credit-model: true
  yarn.per-job-cluster.include-user-jar: FIRST

  base_jar: deploy/flink-1.9/basejar/flink-python-byted.jar
  bin: deploy/flink-1.9/bin/flink
  vcores: 4
  ms_url: http://ms.byted.org
  ms_zone: CN
  dataSource: bytetsd
  HADOOP_CONF_DIR: /opt/tiger/yarn_deploy/hadoop-2.6.0-cdh5.4.4/conf/
  kafka_server_url: http://kafka-config.byted.org

  # Configurations for smart resources
  smart-resources.service-name: data.inf.sr_estimater.service.lf
  log4j.appender.databus.channel: yarn_container_level_log

  # Configurations for docker mode
  runtime.lib.dir: /opt/tiger/flink_deploy/deploy/flink-1.9/lib
  runtime.conf.dir: /opt/tiger/flink_deploy/deploy/flink-1.9/conf

  docker.default_image: yarn_runtime_flink_1.9:latest
  docker.image.include_lib: false
  docker.authorization: "Basic Rmxpbms6Z2huZTZrcGdqM2RvMzcxNHF0djBrZWYxbnd3aHNra2Q="
  docker.version_template_url: http://%s/api/v1/images/self-make/latest_tag/?psm=%s&region_list=%s
  docker.server: image-manager.byted.org
  docker.hub: hub.byted.org
  docker.region: China-North-LF

  nmclientasync.enabled: true
  yarn.gang-scheduler.enable: false
  taskmanager.initial-on-start: false
  taskmanager.network.netty.client.readTimeout.enabled: true

flink:
  dc: cn
  clusterName: flink
  high-availability.zookeeper.quorum: 10.17.58.36:2181,10.17.58.40:2181,10.17.58.44:2181,10.17.58.45:2181,10.17.58.78:2181
  hdfs.prefix: hdfs://haruna/flink_lf

dw:
  dc: cn
  clusterName: dw
  high-availability.zookeeper.quorum: 10.8.41.98:2184,10.6.18.154:2184,10.6.16.79:2184,10.11.43.39:2184,10.11.43.66:2184
  hdfs.prefix: hdfs://haruna/flink_lf

lepad:
  dc: cn
  clusterName: lepad
  high-availability.zookeeper.quorum: 10.8.32.25:2184,10.8.32.68:2184,10.8.32.74:2184,10.8.32.72:2184,10.8.39.142:2184
  hdfs.prefix: hdfs://haruna/flink_lf

oryx:
  dc: cn
  clusterName: oryx
  high-availability.zookeeper.quorum: 10.8.32.25:2184,10.8.32.68:2184,10.8.32.74:2184,10.8.32.72:2184,10.8.39.142:2184
  hdfs.prefix: hdfs://haruna/flink_lf

default:
  dc: cn
  clusterName: default
  high-availability.zookeeper.quorum: 10.8.32.25:2184,10.8.32.68:2184,10.8.32.74:2184,10.8.32.72:2184,10.8.39.142:2184
  hdfs.prefix: hdfs://haruna/flink_lf

leser:
  dc: cn
  clusterName: leser
  high-availability.zookeeper.quorum: 10.8.32.25:2184,10.8.32.68:2184,10.8.32.74:2184,10.8.32.72:2184,10.8.39.142:2184
  hdfs.prefix: hdfs://haruna/flink_lf

lobst:
  dc: cn
  clusterName: lobst
  high-availability.zookeeper.quorum: 10.8.32.25:2184,10.8.32.68:2184,10.8.32.74:2184,10.8.32.72:2184,10.8.39.142:2184
  hdfs.prefix: hdfs://haruna/flink_lf

wj:
  dc: cn
  clusterName: wj
  high-availability.zookeeper.quorum: 10.8.32.25:2184,10.8.32.68:2184,10.8.32.74:2184,10.8.32.72:2184,10.8.39.142:2184
  hdfs.prefix: hdfs://haruna/flink_wj

hl:
  dc: cn
  clusterName: hl
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

hyrax:
  dc: cn
  clusterName: hyrax
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

horse:
  dc: cn
  clusterName: horse
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

hibis:
  dc: cn
  clusterName: hibis
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

topi:
  dc: cn
  clusterName: topi
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

hippo:
  dc: cn
  clusterName: hippo
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

heron:
  dc: cn
  clusterName: heron
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

hamer:
  dc: cn
  clusterName: hamer
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

hyena:
  dc: cn
  clusterName: hyena
  high-availability.zookeeper.quorum: 10.23.72.70:2181,10.23.73.159:2181,10.23.73.222:2181,10.23.73.69:2181,10.23.73.81:2181
  hdfs.prefix: hdfs://haruna/flink_hl

maliva:
  dc: va
  clusterName: maliva
  high-availability.zookeeper.quorum: 10.110.150.57:2181,10.110.150.58:2181,10.110.150.59:2181,10.110.150.60:2181,10.110.150.61:2181
  hdfs.prefix: hdfs://harunavaali/flink_maliva
  dataSource: bytetsd_maliva
  smart-resources.service-name: data.inf.sr_estimater.service.maliva
  kafka_server_url: http://kafka-config-va.byted.org
  log4j.appender.databus.channel: yarn_container_level_log_mva_aliyun
  # TODO(zoudan): replace docker server with domain url
  docker.server: 10.8.27.231:8002
  docker.hub: aliyun-va-hub.byted.org
  docker.region: Aliyun_VA

alisg:
  dc: sg
  clusterName: alisg
  high-availability.zookeeper.quorum: 10.115.61.129:2181,10.115.61.130:2181,10.115.61.131:2181,10.115.61.132:2181,10.115.61.133:2181
  hdfs.prefix: hdfs://harunasg/flink_alisg
  dataSource: bytetsd_alisg
  smart-resources.service-name: data.inf.sr_estimater.service.alisg
  kafka_server_url: http://kafka-config-sg.byted.org
  log4j.appender.databus.channel: yarn_container_level_log_sg
  # TODO(zoudan): replace docker server with domain url
  docker.server: 10.8.27.231:8002
  docker.hub: aliyun-sin-hub.byted.org
  docker.region: Aliyun_SG

boe:
  dc: vm
  clusterName: boe
  high-availability.zookeeper.quorum: 10.225.33.2:2181,10.225.28.3:2181,10.225.33.6:2181,10.225.125.22:2181,10.225.125.29:2181
  hdfs.prefix: hdfs://westeros/flink_boe
  dataSource: boe
  kafka_server_url: http://kafka-config.byted.org
  log4j.appender.databus.channel: yarn_container_level_log
  # TODO(zhangguanghui): Waiting for Yaop to replace it with a domain url
  yaop_url: http://10.225.131.41:8092
  yaop_token: 0ed7ea2fce8d4801a9d79adde7a91211
cof:
  dc: vm
  clusterName: cof
  high-availability.zookeeper.quorum: 10.225.33.2:2181,10.225.28.3:2181,10.225.33.6:2181,10.225.125.22:2181,10.225.125.29:2181
  hdfs.prefix: hdfs://westeros/flink_cof
  dataSource: cof
  kafka_server_url: http://kafka-config.byted.org
  log4j.appender.databus.channel: yarn_container_level_log
  # TODO(zhangguanghui): Waiting for Yaop to replace it with a domain url
  yaop_url: http://10.225.131.41:8092
  yaop_token: 0ed7ea2fce8d4801a9d79adde7a91211
